<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bouletta ‚Äî —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω</title>
  <meta name="description" content="–®–∫—ñ—Ä—è–Ω—ñ —Å—É–º–∫–∏ —Ç–∞ –∞–∫—Å–µ—Å—É–∞—Ä–∏ Bouletta. –û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥, —à–≤–∏–¥–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∞, –±–µ–∑–ø–µ—á–Ω–∞ –æ–ø–ª–∞—Ç–∞." />
  <!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">


  <style>
    :root{--bg:#f6f7fb;--card:#fff;--text:#16181d;--muted:#6b7280;--primary:#2563eb;--border:#e5e7eb;--accent:#111827}
    *{box-sizing:border-box}
    html{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;scroll-behavior:smooth}
    body{margin:0;background:var(--bg);color:var(--text);font-size:clamp(14px,2.3vw,16px);line-height:1.5}
    img{max-width:100%;display:block}
    button{font:inherit}
    a{color:inherit}

    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);padding:12px 16px;display:flex;gap:12px;align-items:center;z-index:30}
    header h1{font-size:clamp(16px,4.5vw,20px);margin:0;font-weight:800;letter-spacing:.2px;white-space:nowrap}
    .spacer{flex:1}
    .btn{appearance:none;border:1px solid var(--border);background:#fff;color:var(--accent);padding:10px 14px;border-radius:12px;font-weight:650;cursor:pointer;line-height:1}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff;border-radius:10px;transition:background-color .25s,box-shadow .25s,transform .2s}
    .btn.primary:hover{background:#1e4fd9;box-shadow:0 6px 14px rgba(37,99,235,.25);transform:translateY(-1px)}
    .btn.primary:active{background:#1b46c7;transform:none;box-shadow:0 2px 8px rgba(37,99,235,.2)}
    .btn.icon{display:inline-flex;gap:8px;align-items:center}

    .toolbar{display:grid;gap:10px;padding:12px 16px;background:#fff;border-bottom:1px solid var(--border);grid-template-columns:1fr 1fr 1fr}
    @media(max-width:1100px){.toolbar{grid-template-columns:1fr 1fr}}
    @media(max-width:640px){.toolbar{grid-template-columns:1fr}}
    .label{font-size:12px;color:var(--muted)}
    .input,select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}

    .container{padding:14px;display:grid;gap:14px;grid-template-columns:repeat(4,1fr)}
    @media(max-width:1200px){.container{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:860px){.container{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:560px){.container{grid-template-columns:1fr;padding:12px}}

    .card{background:var(--card);border-radius:16px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 6px 20px rgba(17,24,39,.06)}
    .card .body{padding:12px}
    .card .name{font-weight:800;margin:0 0 4px;font-size:clamp(14px,4vw,16px);line-height:1.25}
    .card .barcode{font-size:12px;color:var(--muted);}
    .meta{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0;font-size:13px}
    .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;background:#fafafa;white-space:nowrap}
    .prices{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
    @media(max-width:560px){.prices{grid-template-columns:1fr}}
    .price-block{border:1px solid var(--border);border-radius:12px;padding:8px;background:#fafbff}
    .retail-block{background:#eef2ff}.wholesale-block{background:#ecfdf5}
    .price-title{font-size:12px;font-weight:800;color:var(--accent);margin-bottom:4px;text-transform:uppercase}
    .pill{display:inline-block;font-variant-numeric:tabular-nums;padding:7px 10px;border-radius:10px;border:1px solid #e6e8ef;font-weight:700}
    .card .footer{margin-top:auto;padding:10px 12px;border-top:1px solid var(--border);display:flex;gap:10px}
    /* –µ—Ñ–µ–∫—Ç –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è —Ç—ñ–Ω–Ω—é –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ –Ω–∞ –∫–∞—Ä—Ç–∫—É —Ç–æ–≤–∞—Ä—É */
    .card {
      transition: transform .25s ease, box-shadow .25s ease;
      box-shadow: 0 2px 6px rgba(0,0,0,.06);
    }
    .card:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
      cursor: pointer;
    }

    .slider{position:relative;aspect-ratio:4/3;overflow:hidden}
    .slides{display:flex;height:100%;overflow-x:auto;scroll-snap-type:x mandatory;scroll-behavior:smooth;gap:0;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .slides::-webkit-scrollbar{display:none}
    .slide{min-width:100%;position:relative;flex:0 0 100%;scroll-snap-align:center}
    .slide img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;background:#fff}

    .status{padding:0 16px 10px;color:var(--muted);font-size:13px}

    #cart{position:fixed;top:0;right:-420px;width:380px;max-width:96vw;height:100vh;background:#fff;border-left:1px solid var(--border);box-shadow:-8px 0 30px rgba(0,0,0,.08);transition:right .25s;display:flex;flex-direction:column;z-index:50}
    #cart.open{right:0}
    #cart .head{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
    #cart .body{padding:10px 12px;flex:1;overflow:auto;display:flex;flex-direction:column;gap:10px}
    .cart-item{display:grid;grid-template-columns:56px minmax(0,1fr) auto;gap:10px;align-items:start;border:1px solid var(--border);border-radius:12px;padding:8px}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px;grid-row:1/span 3}
    .qty{display:inline-flex;align-items:center;gap:6px;margin-top:6px}
    .qty input{width:48px;text-align:center;padding:6px;border:1px solid var(--border);border-radius:8px}
    #cart .foot{padding:12px;border-top:1px solid var(--border)}

    /* === Checkout Drawer === */
    #checkout{position:fixed;bottom:0;left:0;right:0;max-height:92vh;background:#fff;border-top:1px solid var(--border);box-shadow:0 -8px 30px rgba(0,0,0,.08);transform:translateY(100%);transition:transform .25s ease;z-index:60}
    #checkout.open{transform:none}
    .ck-head{display:flex;gap:8px;align-items:center;padding:12px 14px;border-bottom:1px solid var(--border)}
    .ck-body{padding:12px 14px;display:grid;gap:14px}
    .step{border:1px solid var(--border);border-radius:12px;padding:12px}
    .step h4{margin:0 0 8px;font-size:14px}
    .grid{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    @media(max-width:720px){.grid{grid-template-columns:1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .hint{font-size:12px;color:var(--muted)}
    .total{font-weight:800}
    .ok{color:#059669}.bad{color:#b91c1c}
    .tag{display:inline-block;border:1px dashed var(--border);padding:2px 8px;border-radius:999px;font-size:12px}
#checkout{
  display:flex;                /* –¥–æ–∑–≤–æ–ª—è—î –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—é –≤–∏—Å–æ—Ç–æ—é */
  flex-direction:column;
  max-height:100svh;           /* –≤—Ä–∞—Ö–æ–≤—É—î –º–æ–±—ñ–ª—å–Ω—ñ –ø–∞–Ω–µ–ª—ñ */
}
#checkout .ck-body{
  flex:1 1 auto;
  min-height:0;                /* —â–æ–± flex-–¥–∏—Ç–∏–Ω–∞ –º–æ–≥–ª–∞ —Å–∫—Ä–æ–ª–∏—Ç–∏—Å—è */
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}
@media (max-width:560px){
  #checkout{
    border-top-left-radius:16px;
    border-top-right-radius:16px;
  }
}
    /* ==== Mobile polish ==== */
    @media (max-width: 560px){
      header{flex-wrap:wrap;gap:8px}
      .spacer{display:none}
      .card .footer{flex-direction:column}
      .btn{width:100%}
      .card .body{padding:10px}
      .card .footer{padding:10px}
    }
    @media (max-width: 400px){
      .card .barcode{display:none}
      .badge{padding:3px 8px;font-size:11px}
      .pill{padding:6px 8px;font-size:13px}
      .price-title{font-size:11px}
    }


/* ==== Slider UI (arrows + dots) ==== */
.slider{position:relative}
.slider .slides{scrollbar-width:none}
.slider .slides::-webkit-scrollbar{display:none}
.slider .nav{
  position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;
  pointer-events:none;padding:0 6px;
}
.slider .nav .arrow{
  pointer-events:auto;border:none;background:rgba(0,0,0,.25);color:#fff;border-radius:999px;
  width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;
  opacity:.6
}
.slider .nav .arrow:hover{opacity:.85}
.slider .dots{
  position:absolute;left:50%;bottom:8px;transform:translateX(-50%);display:flex;gap:6px;
  padding:4px 8px;border-radius:999px;background:rgba(0,0,0,.25);backdrop-filter:blur(2px);
}
.slider .dots button{
  width:6px;height:6px;border-radius:50%;border:none;background:#ddd;opacity:.7;cursor:pointer;padding:0;display:block
}
.slider .dots button[aria-current="true"]{opacity:1;background:#fff;transform:scale(1.2)}



/* line clamp for cart titles */
.cart-item .title{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}


@media (max-width:560px){
  #cart{
    position:fixed;left:0;right:0;bottom:0;top:auto;width:100vw;max-width:none;
    height:70vh;max-height:80vh;transform:translateY(100%);
    transition:transform .25s ease;z-index:70;background:var(--panel,#fff);
    border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:0 -8px 24px rgba(0,0,0,.15);
    display:flex;flex-direction:column;
  }
  #cart.open{transform:translateY(0)}
  #cart .head{flex:0 0 auto;position:sticky;top:0;background:inherit;z-index:1}
  #cart .body{flex:1 1 auto;min-height:0;overflow:auto;padding-bottom:10px}
  #cart .foot{flex:0 0 auto;position:sticky;bottom:0;background:inherit;padding-bottom:calc(env(safe-area-inset-bottom, 12px));}
  #cart .foot .row{display:flex;gap:8px;align-items:center}
  #cart .foot .spacer{display:none}
  #cart .foot .btn{flex:1 1 0;min-height:44px}
  #cart .foot .btn.primary{flex:1 1 0}

  /* Checkout drawer internals */
  #checkout .ck-head{position:sticky;top:0;background:var(--panel,#fff);z-index:1}
  #checkout .ck-body{max-height:min(calc(100vh - 140px),80vh);overflow:auto;padding-bottom:90px}
  .ck-actions{position:sticky;bottom:0;background:var(--panel,#fff);padding:10px 0;z-index:1;display:flex;gap:8px;align-items:center}
  .ck-actions .spacer{display:none}
  .ck-actions .btn{flex:1 1 0;min-height:44px}
}

@media (max-width:400px){
  #checkout .ck-body{padding-bottom:96px}
}


@media (max-width: 560px){
  #cart .foot{padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 12px) !important;}
  #cart .body{padding-bottom: 90px !important;}
}


@keyframes cart-bump { 0%{transform:scale(1)} 30%{transform:scale(1.15)} 100%{transform:scale(1)} }
#cartBtn.bump, #cartCount.bump { animation: cart-bump .35s ease; }

.fly-clone{
  position:fixed; z-index: 9999; pointer-events:none;
  transition: transform .6s cubic-bezier(.22,.61,.36,1), opacity .6s ease;
  will-change: transform, opacity;
}


/* Quick glow on cart button when item added */
@keyframes cart-glow {
  0% { box-shadow: 0 0 0 0 rgba(0,128,255,0); }
  30% { box-shadow: 0 0 0 6px rgba(0,128,255,.25); }
  100% { box-shadow: 0 0 0 0 rgba(0,128,255,0); }
}
#cartBtn.flash { animation: cart-bump .35s ease, cart-glow .6s ease; }


@media (max-width:560px){
  #cart .head{position:sticky;top:0;background:inherit;z-index:1}
  #cart .body{flex:1 1 auto;min-height:0;overflow:auto}
  #cart .foot{position:sticky;bottom:0;z-index:1;background:inherit}
  .ck-actions{position:sticky;bottom:0;z-index:1;background:inherit}
}


/* Center the cart button on mobile */
@media (max-width:560px){
  header{flex-wrap:wrap;justify-content:center;gap:8px}
  #cartBtn{order:2}
  #resetBtn{order:1}
}
#cartBtn .icon{display:inline-block;width:1em;height:1em;vertical-align:-0.15em;margin-right:6px}
#cartBtn .icon svg{width:1em;height:1em;display:block}


/* === Checkout actions pinned below content (no overlap) === */
:root{ --ck-actions-h: 64px; }
.ck-actions{ min-height: var(--ck-actions-h); }
#checkout .ck-body{ padding-bottom: calc(var(--ck-actions-h) + 24px); }

@media (max-width:560px){
  :root{ --ck-actions-h: 72px; }
  #checkout .ck-body{ padding-bottom: calc(var(--ck-actions-h) + env(safe-area-inset-bottom, 12px)); }
}


/* Ensure the cart button is perfectly centered on mobile */
@media (max-width:560px){
  header{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
  }
  #cartBtn{
    margin:8px auto;
    align-self:center;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  #cartBtn .icon{margin-right:6px}
}


/* === Required field highlighting === */
.input.err, input.err, textarea.err, select.err{
  border-color:#ef4444 !important;
  box-shadow:0 0 0 2px rgba(239,68,68,.15) !important;
}
label.field.err .input{
  border-color:#ef4444 !important;
  box-shadow:0 0 0 2px rgba(239,68,68,.15) !important;
}


  /* === WHOLESALE BADGES === */
  .wholesale-flag{
    display:none;
    align-items:center;
    gap:8px;
    margin:6px 0 8px;
    padding:8px 10px;
    border-radius:10px;
    background: linear-gradient(90deg, rgba(16,185,129,.12), rgba(16,185,129,.06));
    border:1px solid rgba(16,185,129,.35);
    font-weight:600; font-size:12px;
  }
  .wholesale-flag:before{ content:"‚úì"; font-weight:700 }
  .wholesale-note{
    display:none;
    margin-top:8px;
    padding:8px 10px;
    border-radius:10px;
    background: linear-gradient(90deg, rgba(16,185,129,.12), rgba(16,185,129,.06));
    border:1px solid rgba(16,185,129,.35);
    font-size:12px; font-weight:600;
  }
</style>
</head>
<body>
  <header>
    <h1>Bouletta ‚Äî –∫–∞—Ç–∞–ª–æ–≥</h1>
    <div class="spacer"></div>
    <button class="btn" id="resetBtn">–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä</button>
    <button class="btn icon" id="cartBtn">–ö–æ—à–∏–∫ (<span id="cartCount">0</span>)</button>
  </header>

  <section class="toolbar">
    <div>
      <div class="label">–¢–∏–ø —Ç–æ–≤–∞—Ä—É</div>
      <select id="typeSel" class="input"><option value="">–í—Å—ñ</option></select>
    </div>
    <div>
      <div class="label">–ö–æ–ª—ñ—Ä</div>
      <select id="colorSel" class="input"><option value="">–í—Å—ñ</option></select>
    </div>
    <div>
      <div class="label">–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è</div>
      <select id="sort" class="input">
        <option value="name-asc">–ù–∞–∑–≤–∞ (–ê‚Üí–Ø)</option>
        <option value="name-desc">–ù–∞–∑–≤–∞ (–Ø‚Üí–ê)</option>
        <option value="retailUAH-asc">–†–æ–∑–¥—Ä—ñ–± UAH ‚Üë</option>
        <option value="retailUAH-desc">–†–æ–∑–¥—Ä—ñ–± UAH ‚Üì</option>
        <option value="wholesaleUAH-asc">–û–ø—Ç UAH ‚Üë</option>
        <option value="wholesaleUAH-desc">–û–ø—Ç UAH ‚Üì</option>
      </select>
    </div>
  </section>

  <section class="toolbar" style="border-top:0">
    <div>
      <div class="label">–ö—É—Ä—Å USD ‚Üí UAH</div>
      <div class="row" style="display:flex;gap:8px;align-items:center">
        <input id="rateInput" class="input" inputmode="decimal" placeholder="–ù–∞–ø—Ä.: 41.00" style="max-width:150px" />
        <button class="btn" id="btnUpdateRate">–û–Ω–æ–≤–∏—Ç–∏ (–ù–ë–£)</button>
      </div>
      <small class="hint" id="rateInfo">–ü–æ—Ç–æ—á–Ω–∏–π –∫—É—Ä—Å: 41.00</small>
    </div>
    <div>
      <div class="label">–ï–∫—Å–ø–æ—Ä—Ç</div>
      <div class="row" style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="exportXLSX">Excel</button>
      </div>
      <small class="hint">–ï–∫—Å–ø–æ—Ä—Ç –ø–æ—Ç–æ—á–Ω–æ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤</small>
    </div>
    <div>
        <input id="promo" style="display:none">
      </div>
    </div>
  </section>

  <div class="status" id="status"></div>
  <section class="container" id="grid"></section>

  <!-- –ö–æ—à–∏–∫ -->
  <aside id="cart">
    <div class="head">
      <strong style="font-size:14px">–í–∞—à –∫–æ—à–∏–∫</strong>
      <div class="spacer"></div>
      <button class="btn" id="closeCart">‚úï</button>
    </div>
    <div class="body" id="cartList"></div>
    <div class="foot">
      <div class="row" style="display:flex;justify-content:space-between;align-items:center;margin:6px 0"><span>–†–∞–∑–æ–º</span><b id="cartTotal">0 –≥—Ä–Ω ‚Ä¢ $0</b></div>
      <div class="row" style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="cartClear">–û—á–∏—Å—Ç–∏—Ç–∏</button>
        <div class="spacer"></div>
        <button class="btn primary" id="checkoutBtn">–û—Ñ–æ—Ä–º–∏—Ç–∏</button>
      </div>
    </div>
  </aside>

  <!-- –ß–µ–∫–∞—É—Ç -->
  <section id="checkout" aria-hidden="true">
    <div class="ck-head">
      <strong>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</strong>
      <div class="spacer"></div>
      <button class="btn" id="closeCheckout">–ó–≥–æ—Ä–Ω—É—Ç–∏</button>
    </div>
    <div class="ck-body">
      <!-- –ö–†–û–ö 1: –ö–æ–Ω—Ç–∞–∫—Ç–∏ -->
      <div class="step">
        <h4>1) –ö–æ–Ω—Ç–∞–∫—Ç–∏</h4>
        <div class="grid">
          <label class="field"><span>–Ü–º‚Äô—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ*</span><input id="fName" class="input" placeholder="–û–ª–µ–∫—Å—ñ–π –Ü–≤–∞–Ω–µ–Ω–∫–æ" required></label>
          <label class="field"><span>–¢–µ–ª–µ—Ñ–æ–Ω*</span><input id="fPhone" class="input" placeholder="+380" required></label>
          <label class="field"><span>Email</span><input id="fEmail" class="input" placeholder="name@email.com"></label>
          <label class="field"><span>–ö–æ–º–µ–Ω—Ç–∞—Ä</span><input id="fNote" class="input" placeholder="–ü–æ–±–∞–∂–∞–Ω–Ω—è –¥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è"></label>
        </div>
        <small class="hint">–ü–æ–∑–Ω–∞—á–µ–Ω—ñ * –ø–æ–ª—è ‚Äî –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ.</small>
      </div>

      <!-- –ö–†–û–ö 2: –î–æ—Å—Ç–∞–≤–∫–∞ -->
      <div class="step">
        <h4>2) –î–æ—Å—Ç–∞–≤–∫–∞</h4>
        <div class="grid">
          <label class="field"><span>–°–ø–æ—Å—ñ–±*</span>
            <select id="fShip" class="input">
              <option value="nova">–ù–æ–≤–∞ –ü–æ—à—Ç–∞ (–≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è)</option>
              <option value="np_courier">–ù–æ–≤–∞ –ü–æ—à—Ç–∞ (–∫—É—Ä‚Äô—î—Ä)</option>
              <option value="meest">Meest</option>
              <option value="pickup">–°–∞–º–æ–≤–∏–≤—ñ–∑</option>
            </select>
          </label>
          <label class="field"><span>–ú—ñ—Å—Ç–æ*</span><input id="fCity" class="input" placeholder="–ö–∏—ó–≤" required></label>
          <label class="field"><span>–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è/–ê–¥—Ä–µ—Å–∞*</span><input id="fAddress" class="input" placeholder="‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –∞–±–æ –∞–¥—Ä–µ—Å–∞" required></label>
          <div></div>
        </div>
      </div>

      <!-- –ö–†–û–ö 3: –û–ø–ª–∞—Ç–∞ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è -->
      <div class="step">
        <h4>3) –û–ø–ª–∞—Ç–∞</h4>
        <div class="grid">
          <label class="field"><span>–ú–µ—Ç–æ–¥*</span>
            <select id="fPay" class="input">
      <option value="prepay">–ü–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (200 –≥—Ä–Ω)</option>
      <option value="full">–ü–æ–≤–Ω–∞ –æ–ø–ª–∞—Ç–∞</option>
    </select>
          </label>

        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <small class="hint">–ü—ñ–¥—Å—É–º–æ–∫: <span id="ckItems">0 —Ç–æ–≤–∞—Ä—ñ–≤</span></small>
          <div><span class="hint">–î–æ —Å–ø–ª–∞—Ç–∏</span> <span id="ckTotal" class="total">0 –≥—Ä–Ω</span></div>
        </div>
        <div class="ck-actions" style="display:flex;gap:8px;align-items:center;margin-top:10px">
          <button class="btn" id="backToCart">‚Üê –î–æ –∫–æ—à–∏–∫–∞</button>
          <div class="spacer"></div>
          <button class="btn primary" id="placeOrderBtn">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        </div>
        <small class="hint" id="submitState"></small>
      </div>
    </div>
  </section>

  <template id="cardTpl">
    <article class="card">
      <div class="media"><div class="slider"><div class="slides"></div></div></div>
      <div class="body">
        <h3 class="name"></h3>
        <div class="barcode"></div>
        <div class="meta"><span class="type badge"></span><span class="color badge"></span></div>
        <div class="prices">
          <div class="price-block retail-block"><div class="price-title">–†–æ–∑–¥—Ä—ñ–±</div><div class="price-row"><span class="pill retail"></span><span class="pill retailUSD"></span></div></div>
          <div class="price-block wholesale-block"><div class="price-title">–û–ø—Ç</div><div class="price-row"><span class="pill opt"></span><span class="pill optUSD"></span></div></div>
        </div>
      </div>
      <div class="footer">

        <div class="spacer"></div>
        <button class="btn primary add">–£ –∫–æ—à–∏–∫</button>
      </div>
    </article>
  </template>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js">
// === Required validation & mask ===
(function(){
  const ids=['fName','fPhone','fCity','fAddress'];
  const $=id=>document.getElementById(id);
  const submitState=document.getElementById('submitState');
  function mark(el,bad){ if(!el) return; if(bad){ el.classList.add('err'); el.closest('label')?.classList?.add('err'); } else { el.classList.remove('err'); el.closest('label')?.classList?.remove('err'); } }
  function check(){
    let ok=true;
    ids.forEach(id=>{
      const el=$(id); if(!el) return;
      let valid=!!el.value && el.value.trim().length>=2;
      if(id==='fPhone') valid=/^\+380\d{9}$/.test((el.value||'').trim());
      mark(el,!valid); ok=ok && valid;
    });
    if(!ok && submitState) submitState.textContent='–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è. –¢–µ–ª–µ—Ñ–æ–Ω —É —Ñ–æ—Ä–º–∞—Ç—ñ +380XXXXXXXXX';
    if(ok && submitState && submitState.textContent) submitState.textContent='';
    return ok;
  }
  // clear on input
  ids.forEach(id=>{ const el=$(id); if(!el) return; ['input','change','blur'].forEach(ev=>{ el.addEventListener(ev,()=>{ if(el.classList.contains('err')){ let valid=!!el.value && el.value.trim().length>=2; if(id==='fPhone') valid=/^\+380\d{9}$/.test((el.value||'').trim()); mark(el,!valid); if(valid && submitState) submitState.textContent=''; } }); }); });
  // phone mask
  const phone=$('fPhone'); if(phone){ const fmt=()=>{ let v=phone.value.replace(/[^\d+]/g,''); if(!v.startsWith('+')) v='+'+v.replace(/^\+/, ''); if(v==='+'||v==='+3'||v==='+38') v='+380'; v=v.slice(0,13); phone.value=v; }; phone.addEventListener('input',fmt); if(!phone.value) phone.value='+380'; }
  window.__validateRequiredAndHighlight=check;
})();


// === Requisites modal controller ===
(function(){
  const modal=document.getElementById('paymentModal');
  const body=document.getElementById('payBody')||document.querySelector('#paymentModal .pb');
  const closeBtn=document.getElementById('payClose');
  const okBtn=document.getElementById('payOk');
  function open(){
    if(body){ body.innerHTML=[
      '<div><strong>–†–µ–∫–≤—ñ–∑–∏—Ç–∏ –¥–ª—è –æ–ø–ª–∞—Ç–∏:</strong></div>',
      '–§–û–ü –ö—É—Ä—Ç –ú–∞—Ö–º—É—Ç –§–∏—Ä–∞—Ç',
      'IBAN: <code>UA713220010000026006350089361</code>',
      '–Ü–ü–ù/–Ñ–î–†–ü–û–£: <code>2938328518</code>',
      '–ú–§–û: <code>322001</code>',
      '–Ñ–î–†–ü–û–£ –ë–∞–Ω–∫—É: <code>21133352</code>',
      '<br>',
      '‚ùóÔ∏è–í –¥–æ–¥–∞—Ç–∫–∞—Ö –±–∞–Ω–∫—ñ–≤ –∞–±–æ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞—Ö –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—Ä–∞—Ç–∏ –ø–ª–∞—Ç—ñ–∂ –∑–∞ IBAN –∞–±–æ –∑–∞ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∞–º–∏.',
      '‚ùóÔ∏è–í –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—ñ –ø–ª–∞—Ç–µ–∂—É –≤–∫–∞–∂—ñ—Ç—å –≤–∞—à–µ –ø—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —ñ–º‚Äô—è.',
      '<br>',
      '–ü—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü—ñ—é –º–µ–Ω–µ–¥–∂–µ–Ω—É –≤ Instagram ‚ù§Ô∏è'
    ].map(s=>`<div class="row">${s}</div>`).join(''); }
    if(modal){ modal.style.display='flex'; modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); }
  }
  function close(){ if(modal){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); modal.style.display='none'; } }
  if(closeBtn) closeBtn.onclick=close; if(okBtn) okBtn.onclick=close;
  window.__openRequisitesMessage=open;
})();

</script>
  <script src="products.js"></script>
  <script>
// –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ç–∞–ª–æ–≥—É: —Å—Ç–≤–æ—Ä—é—î–º–æ CATALOG –±–µ–∑ –∑–º—ñ–Ω–∏ const products
(function(){
  let base = [];
  try{
    if (Array.isArray(window.products)) base = window.products;
    else if (typeof products !== 'undefined' && Array.isArray(products)) base = products;
  }catch(e){ base = []; }
  window.CATALOG = base.map(p => ({
    ...p,
    barcode: String(p?.barcode ?? '').trim(),
    name: String(p?.name ?? '').trim(),
    type: p?.type ? String(p.type).trim() : '',
    color: p?.color ? String(p.color).trim() : '',
    imgs: Array.isArray(p?.imgs) ? p.imgs.filter(Boolean) : []
  }));
})();
</script>

  <script>
    /* =================== CONFIG =================== */
    const CONFIG = {
      DEFAULT_IMG: 'https://placehold.co/800x600/png?text=–§–æ—Ç–æ',
      RATE: 41.20,
      PROMOCODES: { 'WELCOME5': 0.05, 'VIP10': 0.10 },
      APPS_SCRIPT_WEBHOOK: 'https://script.google.com/macros/s/AKfycbwLb1Hmyb5HZPfutet7aqGNnbxnsHdLnncm24NfhYxYuEzVZ0Xv77rpB9bH7WGan9w/exec', // <-- –≤—Å—Ç–∞–≤—Ç–µ URL –≤–µ–±—Ö—É–∫–∞
      TELEGRAM: { ENABLED:true, BOT_TOKEN:'8279996038:AAGt-f0lfhlJAyIARqXfsZm7OIQzrBXJ_A4', CHAT_ID:'-4861598462' } // –æ–ø—Ü—ñ–π–Ω–æ
    };
    const productsContainer = document.getElementById('products');


    // ==== –°–¢–ê–ù
    let state = {
      rate: CONFIG.RATE,
      items: [], // –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—ñ
      cart: JSON.parse(localStorage.getItem('cart')||'[]'),
      promo: null
    };

    // ==== –£–¢–ò–õ–Ü–¢–ò
    const fmtUAH = v => (Math.round(v).toLocaleString('uk-UA')+ ' –≥—Ä–Ω');
    const fmtUSD = v => ('$' + (Math.round(v*100)/100).toFixed(2));
    // ==== –û–ü–¢–û–í–ï –¶–Ü–ù–û–£–¢–í–û–†–ï–ù–ù–Ø
    const WHOLESALE_THRESHOLD_USD = 500;
    function wholesaleActive(){
      const retailUSD = state.cart.reduce((s,i)=> s + i.qty * (i.retailUSD ?? i.priceUSD ?? 0), 0);
      return retailUSD > WHOLESALE_THRESHOLD_USD;
    }
    function priceFor(item){
      if(wholesaleActive()){
        return {
          UAH: item.wholesaleUAH ?? item.priceUAH ?? item.retailUAH ?? 0,
          USD: item.wholesaleUSD ?? item.priceUSD ?? item.retailUSD ?? 0,
          mode: 'wholesale'
        };
      }
      return {
        UAH: item.retailUAH ?? item.priceUAH ?? 0,
        USD: item.retailUSD ?? item.priceUSD ?? 0,
        mode: 'retail'
      };
    }

    const round2 = v => Math.round(v*100)/100;
    const el = sel => document.querySelector(sel);

    // ==== –†–ï–ù–î–ï–† –ö–ê–†–¢–û–ö
    const grid = el('#grid');
    const tpl = el('#cardTpl');

    function renderGrid(list){
      grid.innerHTML = '';
      list.forEach(p=>{
        const node = tpl.content.cloneNode(true);
        const card = node.querySelector('.card');
        card.querySelector('.name').textContent = p.name;
        card.querySelector('.barcode').textContent = p.barcode || '';
        card.querySelector('.type').textContent = p.type || '';
        card.querySelector('.color').textContent = p.color || '';
        card.querySelector('.retail').textContent = fmtUAH(p.retailUAH);
        card.querySelector('.retailUSD').textContent = fmtUSD(p.retailUSD);
        card.querySelector('.opt').textContent = fmtUAH(p.wholesaleUAH);
        card.querySelector('.optUSD').textContent = fmtUSD(p.wholesaleUSD);

        const slides = card.querySelector('.slides');
        const imgs = (p.imgs||[]).flatMap(s=>s.split(';')).map(s=>s.trim()).filter(Boolean);
        (imgs.length?imgs:[CONFIG.DEFAULT_IMG]).forEach(src=>{
          const s = document.createElement('div'); s.className = 'slide';
          const im = document.createElement('img'); im.src = src; im.alt = p.name;
          s.appendChild(im); slides.appendChild(s);
        });

        // –î–æ–¥–∞—Ç–∏ —É –∫–æ—à–∏–∫
        card.querySelector('.add').addEventListener('click', ()=>{ addToCart(p); if(window.__cartAnim) __cartAnim.bumpCart(); });
grid.appendChild(node);
      });
    }

    // ==== –§–Ü–õ–¨–¢–†–ò / –°–û–†–¢
    const typeSel = el('#typeSel');
    const colorSel = el('#colorSel');
    const sortSel = el('#sort');
    typeSel.addEventListener('change', applyFilters);
    colorSel.addEventListener('change', applyFilters);
    sortSel.addEventListener('change', applyFilters);

    function applyFilters(){
      let arr = [...CATALOG];
      const t = typeSel.value; const c = colorSel.value;
      if(t) arr = arr.filter(p=> (p.type||'')===t);
      if(c) arr = arr.filter(p=> (p.color||'')===c);
      const [k,dir] = sortSel.value.split('-');
      arr.sort((a,b)=> (a[k] > b[k] ? 1 : -1) * (dir==='asc'?1:-1));
      state.items = arr;
      renderGrid(arr);
      el('#status').textContent = `–ó–Ω–∞–π–¥–µ–Ω–æ ${arr.length} —Ç–æ–≤–∞—Ä—ñ–≤`;
    }

    function initFilters(){
      const types = [...new Set(CATALOG.map(p=>p.type).filter(Boolean))];
      typeSel.innerHTML = '<option value="">–í—Å—ñ</option>' + types.map(v=>`<option>${v}</option>`).join('');
      const colors = [...new Set(CATALOG.map(p=>p.color).filter(Boolean))];
      colorSel.innerHTML = '<option value="">–í—Å—ñ</option>' + colors.map(v=>`<option>${v}</option>`).join('');
    }

    // ==== –ö—É—Ä—Å –≤–∞–ª—é—Ç
    const rateInput = el('#rateInput'); const rateInfo = el('#rateInfo');
    rateInput.value = state.rate;
    el('#btnUpdateRate').addEventListener('click', async()=>{
      try{
        const r = await fetch('https://bank.gov.ua/NBUStatService/v1/statdirectory/dollar_info?json');
        const j = await r.json();
        const v = Number(j?.[0]?.rate)||state.rate; state.rate = v; rateInput.value = v; rateInfo.textContent = `–ü–æ—Ç–æ—á–Ω–∏–π –∫—É—Ä—Å: ${v}`;
      }catch(e){ rateInfo.textContent = '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ ‚Äî –≤–≤–µ–¥—ñ—Ç—å –≤—Ä—É—á–Ω—É'; }
    });
    rateInput.addEventListener('input',()=>{ const v=Number(rateInput.value.replace(',','.')); if(v>0){ state.rate=v; recalcByRate(); }});

    function recalcByRate(){
      CATALOG.forEach(p=>{
        p.retailUAH = Math.round(p.retailUSD * state.rate * 100)/100;
        p.wholesaleUAH = Math.round(p.wholesaleUSD * state.rate * 100)/100;
      });
      applyFilters();
      renderCart();
    }

    // ==== –ö–û–®–ò–ö
    const cartBtn = el('#cartBtn'); const cart = el('#cart');
    const cartCount = el('#cartCount'); const cartList = el('#cartList');

    function saveCart(){ localStorage.setItem('cart', JSON.stringify(state.cart)); }
    function cartTotals(){
      const qty = state.cart.reduce((s,i)=> s+i.qty, 0);
      const sums = state.cart.reduce((acc,i)=> {
        const pf = priceFor(i);
        acc.sumUAH += i.qty * pf.UAH;
        acc.sumUSD += i.qty * pf.USD;
        return acc;
      }, {sumUAH:0, sumUSD:0});
      return {qty, ...sums};
    }
    function refreshCartBadge(){ cartCount.textContent = cartTotals().qty; }

function addToCart(p){
  const barcode = String(p.barcode || '').trim();
  const found = state.cart.find(i => i.barcode === barcode);
  const line = {
    lineId: crypto.randomUUID(),
    name: p.name,
    barcode,
    type: p.type || '',     // ‚Üê –≤–∞–∂–ª–∏–≤–æ
    color: p.color || '',   // ‚Üê –≤–∞–∂–ª–∏–≤–æ
    img: (p.imgs?.[0] || CONFIG.DEFAULT_IMG),
    retailUAH: p.retailUAH, wholesaleUAH: p.wholesaleUAH,
    priceUAH: p.retailUAH,
    retailUSD: p.retailUSD, wholesaleUSD: p.wholesaleUSD,
    priceUSD: p.retailUSD,
    qty: 1
  };
  if (found) found.qty += 1; else state.cart.push(line);
  saveCart(); refreshCartBadge(); renderCart(); }



    function renderCart(){
      cartList.innerHTML = '';
      state.cart.forEach(item=>{
        const row = document.createElement('div'); row.className='cart-item';
        row.innerHTML = `
          <img src="${item.img}" alt="${item.name}">
          <div>
            <div class="title" style="font-weight:700;font-size:14px;line-height:1.2">${item.name}</div>
            <div class="hint">${item.barcode||''}</div>
            <div class="qty">
              <button class="btn" data-dec>-</button>
              <input value="${item.qty}" inputmode="numeric" />
              <button class="btn" data-inc>+</button>
            </div>
          </div>
          <div><b>${fmtUAH(priceFor(item).UAH * item.qty)}</b><br>
              <small class="hint">${fmtUSD(priceFor(item).USD * item.qty)}</small>
              <br><button class="btn" data-del>–í–∏–¥–∞–ª–∏—Ç–∏</button></div>
        `;
        row.querySelector('[data-inc]').onclick = ()=>{ item.qty++; saveCart(); renderCart(); refreshCartBadge(); };
        row.querySelector('[data-dec]').onclick = ()=>{ item.qty=Math.max(1,item.qty-1); saveCart(); renderCart(); refreshCartBadge(); };
        row.querySelector('input').onchange = e=>{ const v=parseInt(e.target.value||'1',10); item.qty=Math.max(1,isNaN(v)?1:v); saveCart(); renderCart(); refreshCartBadge(); };
        row.querySelector('[data-del]').onclick = ()=>{ state.cart = state.cart.filter(x=>x.lineId!==item.lineId); saveCart(); renderCart(); refreshCartBadge(); };
        cartList.appendChild(row);
      });
      const {sumUAH,sumUSD,qty} = cartTotals();
      el('#cartTotal').textContent = `${fmtUAH(sumUAH)} ‚Ä¢ ${fmtUSD(sumUSD)}`;
      el('#ckItems').textContent = `${qty} —Ç–æ–≤–∞—Ä—ñ–≤`;
      el('#ckTotal').textContent = fmtUAH(applyPromo(sumUAH));

      // –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –ø–æ–∑–Ω–∞—á–∫—É "–û–ø—Ç –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ"
      const flagId = 'wholesaleFlag';
      let flag = document.getElementById(flagId);
      if(!flag){
        const foot = document.querySelector('#cart .foot');
        flag = document.createElement('div');
        flag.id = flagId;
        flag.className = 'wholesale-flag';
        foot.insertBefore(flag, foot.firstChild);
      }
      flag.textContent = wholesaleActive() ? '–û–ø—Ç –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ: —Ü—ñ–Ω–∏ –∑–∞ –æ–ø—Ç–æ–º' : '';
      flag.style.display = wholesaleActive() ? 'flex' : 'none';

      // –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–∞ –ø—ñ–¥–∫–∞–∑–∫–∞ —É —á–µ–∫–∞—É—Ç—ñ
      const nId = 'ckWholesaleNote';
      let note = document.getElementById(nId);
      if(!note){
        note = document.createElement('div');
        note.id = nId;
        note.className = 'wholesale-note';
        const step3 = document.querySelector('#checkout .step:nth-of-type(3)');
        step3 && step3.appendChild(note);
      }
      note.textContent = wholesaleActive() ? '–ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –æ–ø—Ç–æ–≤—ñ —Ü—ñ–Ω–∏ (–ø–æ—Ä—ñ–≥ $500 –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ)' : '';
      note.style.display = wholesaleActive() ? 'block' : 'none';
    }

    el('#cartClear').onclick = ()=>{ state.cart=[]; saveCart(); renderCart(); refreshCartBadge(); };
    cartBtn.onclick = openCart; el('#closeCart').onclick = closeCart;
    function openCart(){ cart.classList.add('open'); document.body.classList.add('cart-open'); }
    function closeCart(){ cart.classList.remove('open'); document.body.classList.remove('cart-open'); }

    // ==== –ü–†–û–ú–û–ö–û–î
    const promoBadge = el('#promoState'); const promoInput = el('#promo');
    promoInput.addEventListener('change',()=>{ state.promo = promoInput.value.trim().toUpperCase()||null; renderCart(); updatePromoBadge(); });
    function updatePromoBadge(){
      if(state.promo && CONFIG.PROMOCODES[state.promo]){ promoBadge.textContent = `${state.promo}: -${CONFIG.PROMOCODES[state.promo]*100}%`; promoBadge.classList.add('ok'); promoBadge.classList.remove('bad'); }
      else if(state.promo){ promoBadge.textContent = `${state.promo}: –Ω–µ–¥—ñ–π—Å–Ω–∏–π`; promoBadge.classList.add('bad'); promoBadge.classList.remove('ok'); }
      else{ promoBadge.textContent = '–Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ'; promoBadge.classList.remove('ok','bad'); }
    }
    function applyPromo(sum){ const p = state.promo && CONFIG.PROMOCODES[state.promo]; return p ? Math.round(sum*(1-p)) : sum; }

    // ==== –ß–ï–ö–ê–£–¢
    const checkout = el('#checkout');
    el('#checkoutBtn').onclick = ()=>{ closeCart && closeCart(); openCheckout && openCheckout(); };
    el('#closeCheckout').onclick = ()=> closeCheckout();
    el('#backToCart').onclick = ()=>{ closeCheckout(); openCart(); };

    function openCheckout(){
  checkout.classList.add('open');
  checkout.setAttribute('aria-hidden','false');
  const body = checkout.querySelector('.ck-body');
  if(body){ body.scrollTop = 0; }
}
    function closeCheckout(){ checkout.classList.remove('open'); checkout.setAttribute('aria-hidden','true'); }
    function openCheckoutWithItem(p){ addToCart(p); openCheckout(); }

    // –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    el('#placeOrderBtn').onclick = async()=>{
      if(window.__validateRequiredAndHighlight && !window.__validateRequiredAndHighlight()) return;
      const {sumUAH,sumUSD,qty} = cartTotals();
      if(qty===0){ alert('–î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ —É –∫–æ—à–∏–∫'); return; }

      const order = {
        id: 'B' + Date.now(),
        createdAt: new Date().toISOString(),
        customer: { name:el('#fName').value.trim(), phone:el('#fPhone').value.trim(), email:el('#fEmail').value.trim(), note:el('#fNote').value.trim() },
        shipping: { method:el('#fShip').value, city:el('#fCity').value.trim(), address:el('#fAddress').value.trim() },
        payment: { method:el('#fPay').value },
        promo: state.promo || '',
        currency: { rate: state.rate },
       items: state.cart.map(i => ({
  name: i.name,
  type: i.type,            // ‚Üê –≤–∞–∂–ª–∏–≤–æ
  color: i.color,          // ‚Üê –≤–∞–∂–ª–∏–≤–æ
  barcode: i.barcode,
  priceUAH: i.priceUAH,
  priceUSD: i.priceUSD,
  qty: i.qty
})),

        totals: { qty, sumUAH: applyPromo(sumUAH), sumUSD }
      };

      // –í–∞–ª—ñ–¥–∞—Ü—ñ—è
      if(!order.customer.name || !order.customer.phone || !order.shipping.city || !order.shipping.address){
        el('#submitState').textContent = '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è';
        return;
      }

      el('#submitState').textContent = '–ù–∞–¥—Å–∏–ª–∞—î–º–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è‚Ä¶';

      try{
        // 1) Google Sheet —á–µ—Ä–µ–∑ Apps Script
        if(CONFIG.APPS_SCRIPT_WEBHOOK.startsWith('https://')){
      await fetch(CONFIG.APPS_SCRIPT_WEBHOOK, {
        method: 'POST',
        mode: 'no-cors',    // –≤–∞–∂–ª–∏–≤–æ
        body: JSON.stringify(order)
      });
        }



// --- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ Telegram ---
if (CONFIG.TELEGRAM.ENABLED && CONFIG.TELEGRAM.BOT_TOKEN && CONFIG.TELEGRAM.CHAT_ID) {
  // –õ—ñ—á–∏–ª—å–Ω–∏–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å
  let orderNum = parseInt(localStorage.getItem('orderCounter') || '0', 10) + 1;
  localStorage.setItem('orderCounter', orderNum);

  // ID —Ç–∏–ø—É B01, B02...
  const orderId = 'B' + String(orderNum).padStart(2, '0');
  order.id = orderId;

  const sumUAH = Math.round(order.totals.sumUAH);
  const sumUSD = order.totals.sumUSD.toFixed(2);

  // –§–æ—Ä–º—É—î–º–æ –¥–∞—Ç—É –π —á–∞—Å
  const now = new Date();
  const dateStr = now.toLocaleDateString('uk-UA');
  const timeStr = now.toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });

  // –§–æ—Ä–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤
const itemsList = order.items
  .map((it, i) => {
    const typePart  = it.type  ? ` | ${it.type}` : '';
    const colorPart = it.color ? ` (${it.color})` : '';
    const idPart    = it.barcode ? ` | ID: ${it.barcode}` : '';
    return `${i + 1}) ${it.name}${typePart}${colorPart}${idPart} √ó${it.qty}`;
  })
  .join('\n');


  // –§–æ—Ä–º—É—î–º–æ —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏
  const paymentMethod = order.payment?.method === 'card'
    ? 'üí≥ –û–ø–ª–∞—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–∫—É'
    : 'üíµ –ü—ñ—Å–ª—è–ø–ª–∞—Ç–∞';

  // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è Telegram
  const text = [
    `üõçÔ∏è –ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ${orderId}`,
    `üïí ${dateStr}, ${timeStr}`,
    ``,
    `–Ü–º‚Äô—è: ${order.customer.name}`,
    `–¢–µ–ª: ${order.customer.phone}`,
    `–ú—ñ—Å—Ç–æ: ${order.shipping.city}`,
    `–ê–¥—Ä–µ—Å–∞: ${order.shipping.address}`,
    ``,
    `–¢–æ–≤–∞—Ä—ñ–≤: ${order.totals.qty}`,
    `–°—É–º–∞: ${sumUAH} –≥—Ä–Ω ($${sumUSD})`,
    `${paymentMethod}`,
    ``,
    `üì¶ –ü–æ–∑–∏—Ü—ñ—ó:`,
    itemsList
  ].join('\n');

  try {
    const response = await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM.BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: CONFIG.TELEGRAM.CHAT_ID,
        text
      })
    });

    const result = await response.json();
    if (!result.ok) console.error('–ü–æ–º–∏–ª–∫–∞ Telegram:', result);
  } catch (err) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ –¥–æ Telegram:', err);
  }
}








        // 3) –Ø–∫—â–æ –æ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é ‚Äî —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ –ø–ª–∞—Ç—ñ–∂–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É (–ø—ñ–¥–∫–ª—é—á—ñ—Ç—å –±–µ–∫–µ–Ω–¥)
        if(order.payment.method==='card'){
          alert('–û–ø–ª–∞—Ç–∞ –æ–Ω–ª–∞–π–Ω: –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å –µ–Ω–¥–ø–æ—ñ–Ω—Ç –ø–ª–∞—Ç–µ–∂—É (LiqPay/Monobank/Stripe). –ü–æ–∫–∏ —â–æ ‚Äî –ø—ñ—Å–ª—è–ø–ª–∞—Ç–∞.');
        }

        el('#submitState').textContent = '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ. –î—è–∫—É—î–º–æ!';
        if(window.__openRequisitesMessage) window.__openRequisitesMessage();
        state.cart = []; saveCart(); renderCart(); refreshCartBadge();
        setTimeout(()=>{ closeCheckout(); closeCart(); }, 600);
      }catch(e){
        console.error(e);
        el('#submitState').textContent = '–ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å –Ω–∞–º.';
      }
    };

    // ==== –ï–ö–°–ü–û–†–¢ –£ EXCEL
    el('#exportXLSX').onclick = ()=>{
      const rows = state.items.map(p=> ({
        –ù–∞–∑–≤–∞:p.name, –®—Ç—Ä–∏—Ö–∫–æ–¥:p.barcode, –¢–∏–ø:p.type, –ö–æ–ª—ñ—Ä:p.color,
        –†–æ–∑–¥—Ä—ñ–±_UAH: p.retailUAH, –†–æ–∑–¥—Ä—ñ–±_USD:p.retailUSD,
        –û–ø—Ç_UAH:p.wholesaleUAH, –û–ø—Ç_USD:p.wholesaleUSD,
        –ü–æ—Å–∏–ª–∞–Ω–Ω—è:p.link
      }));
      const ws = XLSX.utils.json_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, '–ö–∞—Ç–∞–ª–æ–≥');
      XLSX.writeFile(wb, 'catalog.xlsx');
    };

    // ==== –Ü–ù–Ü–¢
    el('#resetBtn').onclick = ()=>{ typeSel.value=''; colorSel.value=''; sortSel.value='name-asc'; applyFilters(); };

function boot(){
  if (CATALOG.length===0) {
    document.querySelector('#status').innerHTML = '‚ö†Ô∏è –î–æ–¥–∞–π—Ç–µ –º–∞—Å–∏–≤ <code>products</code> —É CONFIG-–±–ª–æ—Ü—ñ!';
  }
  // –≤–∞–∂–ª–∏–≤–æ: –æ–¥—Ä–∞–∑—É –ø–æ –∫—É—Ä—Å—É –ø–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ UAH-—Ü—ñ–Ω–∏
  recalcByRate();
  initFilters();
  applyFilters();
  refreshCartBadge();
  renderCart();
}

    boot();
  </script>

<script>
(function(){
  function initSlider(slider){
    if(slider.__inited) return;
    const track = slider.querySelector('.slides');
    if(!track) return;
    slider.__inited = true;

    // Build arrows & dots containers
    const nav = document.createElement('div');
    nav.className = 'nav';
    const prev = document.createElement('button');
    prev.className = 'arrow'; prev.type='button'; prev.setAttribute('aria-label','–ü–æ–ø–µ—Ä–µ–¥–Ω—î'); prev.textContent = '‚Äπ';
    const next = document.createElement('button');
    next.className = 'arrow'; next.type='button'; next.setAttribute('aria-label','–ù–∞—Å—Ç—É–ø–Ω–µ'); next.textContent = '‚Ä∫';
    nav.appendChild(prev); nav.appendChild(next);
    const dots = document.createElement('div'); dots.className = 'dots';
    slider.appendChild(nav); slider.appendChild(dots);

    function pageWidth(){ return slider.clientWidth; }
    function slideCount(){ return track.children.length; }

    function goTo(index){
      index = Math.max(0, Math.min(index, slideCount()-1));
      const x = index * pageWidth();
      track.scrollTo({left: x, behavior: 'smooth'});
      updateDotsByIndex(index);
    }

    function activeIndex(){
      const idx = Math.round(track.scrollLeft / pageWidth());
      return Math.max(0, Math.min(idx, slideCount()-1));
    }

    function updateDots(){
      dots.innerHTML = '';
      const n = slideCount();
      for(let i=0;i<n;i++){
        const b = document.createElement('button');
        b.type='button';
        b.setAttribute('aria-label', `–ü–µ—Ä–µ–π—Ç–∏ –¥–æ —Å–ª–∞–π–¥—É ${i+1}`);
        if(i===activeIndex()) b.setAttribute('aria-current','true');
        b.addEventListener('click', ()=>goTo(i));
        dots.appendChild(b);
      }
    }
    function updateDotsByIndex(idx){
      [...dots.children].forEach((b,i)=>{
        if(i===idx) b.setAttribute('aria-current','true'); else b.removeAttribute('aria-current');
      });
    }

    prev.addEventListener('click', ()=>goTo(activeIndex()-1));
    next.addEventListener('click', ()=>goTo(activeIndex()+1));

    // Keep dots in sync on scroll/resize/content changes
    track.addEventListener('scroll', ()=> updateDotsByIndex(activeIndex()), {passive:true});
    window.addEventListener('resize', ()=> updateDotsByIndex(activeIndex()));

    const mo = new MutationObserver(()=>{ updateDots(); updateDotsByIndex(activeIndex()); });
    mo.observe(track, {childList:true, subtree:false});

    // Initialize now
    updateDots();
    updateDotsByIndex(activeIndex());
  }

  function initAll(){
    document.querySelectorAll('.slider').forEach(initSlider);
  }

  document.addEventListener('DOMContentLoaded', initAll);
  // In case cards are added dynamically later:
  const ro = new MutationObserver(()=> initAll());
  ro.observe(document.documentElement, {childList:true, subtree:true});
})();

</script>









<script>
(function(){
  function bumpCart(){
    const btn = document.getElementById('cartBtn');
    const cnt = document.getElementById('cartCount');
    if(btn){
      btn.classList.remove('bump'); btn.classList.remove('flash'); void btn.offsetWidth;
      btn.classList.add('bump'); btn.classList.add('flash');
      btn.addEventListener('animationend', ()=> btn.classList.remove('flash'), {once:true});
    }
    if(cnt){ cnt.classList.remove('bump'); void cnt.offsetWidth; cnt.classList.add('bump'); }
  }
  window.__cartAnim = { bumpCart };
})();
</script>



<script>
(function(){
  const btn = document.getElementById('cartBtn');
  if(btn && !btn.querySelector('.icon')){
    const span = document.createElement('span');
    span.className = 'icon';
    span.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 4h-2a1 1 0 0 0 0 2h1.28l1.7 8.51A2 2 0 0 0 9.93 16h7.4a2 2 0 0 0 1.97-1.6l1.3-6.5A1 1 0 0 0 19.6 6H8.22l-.3-1.45A2 2 0 0 0 7 4Zm3 16a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm9 0a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"/></svg>';
    btn.prepend(span);
  }
})();
</script>


<!-- Requisites Modal -->
<div id="paymentModal" aria-hidden="true" style="position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000;padding:16px">
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="payTitle" style="background:#fff;max-width:720px;width:100%;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.25);overflow:hidden">
    <div class="ph" style="display:flex;align-items:center;gap:8px;padding:12px 14px;border-bottom:1px solid var(--border)">
      <strong id="payTitle">–û–ø–ª–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</strong>
      <div class="spacer" style="flex:1"></div>
      <button class="btn" id="payClose">‚úï</button>
    </div>
    <div class="pb" id="payBody" style="padding:14px;display:grid;gap:10px;line-height:1.55"></div>
    <div class="actions" style="display:flex;gap:8px;justify-content:flex-end;padding:12px 14px;border-top:1px solid var(--border)">
      <button class="btn" id="payOk">–ì–æ—Ç–æ–≤–æ</button>
    </div>
  </div>
</div>





<script>
(function(){
  // helper shortcuts
  const $ = (sel)=>document.querySelector(sel);
  const el = (sel)=>document.querySelector(sel);

  // Ensure payment options are correct even if rendered later
  function ensurePayOptions(){
    const sel = document.getElementById('fPay');
    if(!sel) return;
    const html = '<option value="prepay">–ü–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (200 –≥—Ä–Ω)</option><option value="full">–ü–æ–≤–Ω–∞ –æ–ø–ª–∞—Ç–∞</option>';
    if(sel.innerHTML.trim() !== html) sel.innerHTML = html;
  }

  // Prepay availability and summary
function updatePaymentAvailability(){
  const sel = document.getElementById('fPay');
  if(!sel) return;
  const prepay = sel.querySelector('option[value="prepay"]');
  if(!prepay) return;

  // –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ "–ü–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω", —è–∫—â–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –æ–ø—Ç–æ–≤—ñ —Ü—ñ–Ω–∏
  const isWholesale = (typeof wholesaleActive === 'function') ? wholesaleActive() : false;
  prepay.disabled = !!isWholesale;
  if(isWholesale && sel.value === 'prepay'){
    sel.value = 'full';
  }
}

  function updatePaySummary(){
    const sel = document.getElementById('fPay');
    const totalEl = document.getElementById('ckTotal');
    if(!sel || !totalEl) return;
    try{
      if(sel.value === 'prepay'){
        totalEl.textContent = '200 –≥—Ä–Ω (–ø–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞)';
      }else if(typeof cartTotals==='function' && typeof applyPromo==='function' && typeof fmtUAH==='function'){
        const { sumUAH } = cartTotals();
        totalEl.textContent = fmtUAH(applyPromo(sumUAH));
      }
    }catch(e){ /* ignore */ }
  }

  // Required fields validation + mask
  const reqIds = ['fName','fPhone','fCity','fAddress'];
  function mark(el,bad){
    if(!el) return;
    if(bad){ el.classList.add('err'); el.closest('label') && el.closest('label').classList.add('err'); }
    else { el.classList.remove('err'); el.closest('label') && el.closest('label').classList.remove('err'); }
  }
  function validateRequired(){
    let ok = true;
    const submitState = document.getElementById('submitState');
    reqIds.forEach(id=>{
      const node = document.getElementById(id);
      if(!node) return;
      let valid = !!node.value && node.value.trim().length >= 2;
      if(id==='fPhone'){
        const v = (node.value||'').trim();
        valid = /^\+380\d{9}$/.test(v);
      }
      mark(node, !valid);
      ok = ok && valid;
    });
    if(!ok && submitState){
      submitState.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è. –¢–µ–ª–µ—Ñ–æ–Ω —É —Ñ–æ—Ä–º–∞—Ç—ñ +380XXXXXXXXX';
    }else if(submitState){
      submitState.textContent = '';
    }
    return ok;
  }
  // live clear highlight
  reqIds.forEach(id=>{
    const node = document.getElementById(id);
    if(node){
      ['input','change','blur'].forEach(ev=>{
        node.addEventListener(ev, ()=>{
          if(node.classList.contains('err')){
            let valid = !!node.value && node.value.trim().length >= 2;
            if(id==='fPhone'){
              const v = (node.value||'').trim();
              valid = /^\+380\d{9}$/.test(v);
            }
            mark(node, !valid);
          }
        });
      });
    }
  });
  // phone mask
  const phone = document.getElementById('fPhone');
  if(phone){
    const formatUA = ()=>{
      let v = phone.value.replace(/[^\d+]/g,'');
      if(!v.startsWith('+')) v = '+' + v.replace(/^\+/, '');
      if(v==='+'||v==='+3'||v==='+38') v = '+380';
      v = v.slice(0,13);
      phone.value = v;
    };
    phone.addEventListener('input', formatUA);
    if(!phone.value) phone.value = '+380';
  }

  // Wrap "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è" handler safely
  function wrapPlaceOrder(){
    const btn = document.getElementById('placeOrderBtn');
    if(!btn) return;
    const orig = btn.onclick;
    btn.onclick = async (e)=>{
      if(!validateRequired()){
        e && e.preventDefault && e.preventDefault();
        return;
      }
      if(typeof orig === 'function'){
        const res = await orig.call(btn, e);
        return res;
      }
    };
  }

  // Show requisites modal when success message appears
  function setupSuccessObserver(){
    const target = document.getElementById('submitState');
    if(!target) return;
    const modal = document.getElementById('paymentModal');
    const body = document.getElementById('payBody') || (modal ? modal.querySelector('.pb') : null);
    const closeBtn = document.getElementById('payClose');
    const okBtn = document.getElementById('payOk');
    const openModal = ()=>{
      if(body){
        body.innerHTML = [
          '<div><strong>–†–µ–∫–≤—ñ–∑–∏—Ç–∏ –¥–ª—è –æ–ø–ª–∞—Ç–∏:</strong></div>',
          '–§–û–ü –ö—É—Ä—Ç –ú–∞—Ö–º—É—Ç –§–∏—Ä–∞—Ç',
          'IBAN: <code>UA713220010000026006350089361</code>',
          '–Ü–ü–ù/–Ñ–î–†–ü–û–£: <code>2938328518</code>',
          '–ú–§–û: <code>322001</code>',
          '–Ñ–î–†–ü–û–£ –ë–∞–Ω–∫—É: <code>21133352</code>',
          '<br>',
          '‚ùóÔ∏è–í –¥–æ–¥–∞—Ç–∫–∞—Ö –±–∞–Ω–∫—ñ–≤ –∞–±–æ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞—Ö –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—Ä–∞—Ç–∏ –ø–ª–∞—Ç—ñ–∂ –∑–∞ IBAN –∞–±–æ –∑–∞ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∞–º–∏.',
          '‚ùóÔ∏è–í –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—ñ –ø–ª–∞—Ç–µ–∂—É –≤–∫–∞–∂—ñ—Ç—å –≤–∞—à–µ –ø—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —ñ–º‚Äô—è.',
          '<br>',
          '–ü—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü—ñ—é –º–µ–Ω–µ–¥–∂–µ–Ω—É –≤ Instagram ‚ù§Ô∏è'
        ].map(s=>`<div class="row">${s}</div>`).join('');
      }
      if(modal){
        modal.style.display='flex';
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
      }
      if(closeBtn) closeBtn.onclick = ()=>{ modal.style.display='none'; modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); };
      if(okBtn) okBtn.onclick = ()=>{ modal.style.display='none'; modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); };
    };
    const obs = new MutationObserver(()=>{
      const txt = (target.textContent || '').trim();
      if(txt.includes('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ')){
        openModal();
      }
    });
    obs.observe(target, {childList:true, subtree:true, characterData:true});
  }

  // Bind change for payment select
  function bindPayChange(){
    const sel = document.getElementById('fPay');
    if(!sel) return;
    sel.addEventListener('change', ()=>{ updatePaymentAvailability(); updatePaySummary(); });
  }

  // Initialize after a tiny delay to ensure original handlers are set
  function init(){
    ensurePayOptions();
    updatePaymentAvailability();
    updatePaySummary();
    wrapPlaceOrder();
    setupSuccessObserver();
    bindPayChange();
  }
  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', ()=>setTimeout(init, 50));
  else setTimeout(init, 50);

  // Re-run availability/summary whenever cart re-renders (if app exposes renderCart, monkey-patch it)
  try{
    if(typeof renderCart === 'function'){
      const _renderCart = renderCart;
      window.renderCart = function(){ const res = _renderCart.apply(this, arguments); try{ updatePaymentAvailability(); updatePaySummary(); }catch(e){} return res; };
    }
  }catch(e){}
})();
</script>

<script>
(function(){
  if (window.__filtersInit) return;
  window.__filtersInit = true;

  function qs(id){ return document.getElementById(id); }
  const typeSel = qs('typeFilter') || document.querySelector('[name="type"], select[data-filter="type"]');
  const colorSel= qs('colorFilter')|| document.querySelector('[name="color"], select[data-filter="color"]');
  const sortSel = qs('sortFilter') || document.querySelector('[name="sort"],  select[data-filter="sort"]');
  const grid    = qs('productGrid') || document.querySelector('[data-grid="products"], .product-grid, #grid');

  if (!grid) return;
  const cards = Array.from(grid.querySelectorAll('.product-card, [data-product="card"]'));

  function applyFilters(){
    const t = (typeSel && typeSel.value) ? typeSel.value.trim().toLowerCase() : '';
    const c = (colorSel && colorSel.value)? colorSel.value.trim().toLowerCase(): '';
    const s = (sortSel && sortSel.value) ? sortSel.value : '';

    // Filter show/hide
    cards.forEach(el => {
      const et = (el.getAttribute('data-type')  || '').toLowerCase();
      const ec = (el.getAttribute('data-color') || '').toLowerCase();
      const okType = !t || et === t || et.split(',').includes(t);
      const okColor= !c || ec === c || ec.split(',').includes(c);
      el.style.display = (okType && okColor) ? '' : 'none';
    });

    // Sorting (by price|name or DOM original)
    let visible = cards.filter(el => el.style.display !== 'none');
    let sorted = visible.slice();
    if (s === 'price-asc' || s === 'price-desc'){
      sorted.sort((a,b)=>{
        const pa = parseFloat(a.getAttribute('data-price')||a.dataset.price||0);
        const pb = parseFloat(b.getAttribute('data-price')||b.dataset.price||0);
        return (s==='price-asc') ? (pa - pb) : (pb - pa);
      });
    } else if (s === 'name-asc' || s === 'name-desc'){
      sorted.sort((a,b)=>{
        const na = (a.getAttribute('data-name')||'').toLowerCase();
        const nb = (b.getAttribute('data-name')||'').toLowerCase();
        return (s==='name-asc') ? na.localeCompare(nb) : nb.localeCompare(na);
      });
    } else {
      // no sort -> keep DOM order
      sorted = visible;
    }

    // Re-append in chosen order
    sorted.forEach(el => grid.appendChild(el));
  }

  // Wire once (if elements exist)
  [typeSel, colorSel, sortSel].forEach(sel => {
    if (sel && !sel.__wired){
      sel.addEventListener('change', applyFilters);
      sel.__wired = true;
    }
  });

  // Initial apply (in case there are default values)
  applyFilters();
})();
</script>

</body>
</html>
